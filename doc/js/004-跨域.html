<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>跨域 | 知识库</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="🖖小型前端知识库🖖">
    <link rel="preload" href="/blog-demo/assets/css/0.styles.8f26d5a6.css" as="style"><link rel="preload" href="/blog-demo/assets/js/app.d550568f.js" as="script"><link rel="preload" href="/blog-demo/assets/js/2.9eb2f958.js" as="script"><link rel="preload" href="/blog-demo/assets/js/18.ff8b777b.js" as="script"><link rel="prefetch" href="/blog-demo/assets/js/10.0efb48ae.js"><link rel="prefetch" href="/blog-demo/assets/js/11.284cf3a4.js"><link rel="prefetch" href="/blog-demo/assets/js/12.2e730a1a.js"><link rel="prefetch" href="/blog-demo/assets/js/13.4cbdbc29.js"><link rel="prefetch" href="/blog-demo/assets/js/14.a5dcba57.js"><link rel="prefetch" href="/blog-demo/assets/js/15.12c8c0fe.js"><link rel="prefetch" href="/blog-demo/assets/js/16.36be232d.js"><link rel="prefetch" href="/blog-demo/assets/js/17.a71abff2.js"><link rel="prefetch" href="/blog-demo/assets/js/19.76db4b73.js"><link rel="prefetch" href="/blog-demo/assets/js/20.fad1c0c9.js"><link rel="prefetch" href="/blog-demo/assets/js/21.4d7e21b9.js"><link rel="prefetch" href="/blog-demo/assets/js/22.b8c0287c.js"><link rel="prefetch" href="/blog-demo/assets/js/23.722d8536.js"><link rel="prefetch" href="/blog-demo/assets/js/24.ce2394c7.js"><link rel="prefetch" href="/blog-demo/assets/js/25.851351ef.js"><link rel="prefetch" href="/blog-demo/assets/js/26.1bf51354.js"><link rel="prefetch" href="/blog-demo/assets/js/27.f7cd5aec.js"><link rel="prefetch" href="/blog-demo/assets/js/28.a119db7c.js"><link rel="prefetch" href="/blog-demo/assets/js/29.2cc7ce5b.js"><link rel="prefetch" href="/blog-demo/assets/js/3.71704d6a.js"><link rel="prefetch" href="/blog-demo/assets/js/30.b5b34706.js"><link rel="prefetch" href="/blog-demo/assets/js/31.ea3bc06a.js"><link rel="prefetch" href="/blog-demo/assets/js/32.279d9880.js"><link rel="prefetch" href="/blog-demo/assets/js/33.17366f3a.js"><link rel="prefetch" href="/blog-demo/assets/js/34.228aaca8.js"><link rel="prefetch" href="/blog-demo/assets/js/35.f565841d.js"><link rel="prefetch" href="/blog-demo/assets/js/36.fcbf67df.js"><link rel="prefetch" href="/blog-demo/assets/js/37.136c79a0.js"><link rel="prefetch" href="/blog-demo/assets/js/38.d16994ee.js"><link rel="prefetch" href="/blog-demo/assets/js/39.0958ecda.js"><link rel="prefetch" href="/blog-demo/assets/js/4.ed4e2359.js"><link rel="prefetch" href="/blog-demo/assets/js/40.e63dfa5a.js"><link rel="prefetch" href="/blog-demo/assets/js/41.67123acc.js"><link rel="prefetch" href="/blog-demo/assets/js/42.0568441c.js"><link rel="prefetch" href="/blog-demo/assets/js/43.95ff9579.js"><link rel="prefetch" href="/blog-demo/assets/js/44.7b93a1e3.js"><link rel="prefetch" href="/blog-demo/assets/js/45.94bb121b.js"><link rel="prefetch" href="/blog-demo/assets/js/46.4e956d24.js"><link rel="prefetch" href="/blog-demo/assets/js/47.da5f967a.js"><link rel="prefetch" href="/blog-demo/assets/js/48.21d018d6.js"><link rel="prefetch" href="/blog-demo/assets/js/49.f9355e98.js"><link rel="prefetch" href="/blog-demo/assets/js/5.5d7cadc2.js"><link rel="prefetch" href="/blog-demo/assets/js/50.907acd5d.js"><link rel="prefetch" href="/blog-demo/assets/js/51.2dc13f47.js"><link rel="prefetch" href="/blog-demo/assets/js/6.4b76c2b0.js"><link rel="prefetch" href="/blog-demo/assets/js/7.e5f89a61.js"><link rel="prefetch" href="/blog-demo/assets/js/8.95e64e48.js"><link rel="prefetch" href="/blog-demo/assets/js/9.abb57db4.js">
    <link rel="stylesheet" href="/blog-demo/assets/css/0.styles.8f26d5a6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog-demo/" class="home-link router-link-active"><!----> <span class="site-name">知识库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/blog-demo/doc/js/" aria-current="page" class="sidebar-link">js部分</a></li><li><a href="/blog-demo/doc/js/001-对象原型继承.html" class="sidebar-link">对象原型继承</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/001-对象原型继承.html#_1-构造函数-js的类" class="sidebar-link">1. 构造函数:JS的类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/001-对象原型继承.html#_1-1-使用new命令生成一个对象" class="sidebar-link">1.1 使用new命令生成一个对象</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/001-对象原型继承.html#_1-2-object-create-创建实例对象" class="sidebar-link">1.2 Object.create() 创建实例对象</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/001-对象原型继承.html#_2-原型对象的概述" class="sidebar-link">2. 原型对象的概述</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/001-对象原型继承.html#_2-1-构造函数的缺点" class="sidebar-link">2.1 构造函数的缺点</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/001-对象原型继承.html#_2-2-函数的prototype属性的作用" class="sidebar-link">2.2 函数的prototype属性的作用</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/001-对象原型继承.html#_2-3-原型链" class="sidebar-link">2.3 原型链</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/001-对象原型继承.html#_2-4-constructor属性" class="sidebar-link">2.4 constructor属性</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/001-对象原型继承.html#_3-构造函数的继承" class="sidebar-link">3. 构造函数的继承</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/001-对象原型继承.html#_4-多重继承" class="sidebar-link">4. 多重继承</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/001-对象原型继承.html#_5-instanceof运算符-判断对象的类型" class="sidebar-link">5. instanceof运算符:判断对象的类型</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/001-对象原型继承.html#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/blog-demo/doc/js/002-this_call_apply_bind.html" class="sidebar-link">this、call、apply、bind</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/002-this_call_apply_bind.html#_1-什么是this" class="sidebar-link">1. 什么是this</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/002-this_call_apply_bind.html#_2-不同环境下this的指向" class="sidebar-link">2. 不同环境下this的指向</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/002-this_call_apply_bind.html#_2-1-全局环境：this指向顶层对象window" class="sidebar-link">2.1 全局环境：this指向顶层对象window</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/002-this_call_apply_bind.html#_2-2-构造函数：this指向实例对象" class="sidebar-link">2.2 构造函数：this指向实例对象</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/002-this_call_apply_bind.html#_2-3-对象的方法中-a-b-c-this指向a-b" class="sidebar-link">2.3 对象的方法中(a.b.c()):this指向a.b</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/002-this_call_apply_bind.html#_3-使用this注意点" class="sidebar-link">3. 使用this注意点</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/002-this_call_apply_bind.html#_3-1-避免多层this" class="sidebar-link">3.1 避免多层this</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/002-this_call_apply_bind.html#_3-2-避免数组处理方法中的this" class="sidebar-link">3.2 避免数组处理方法中的this</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/002-this_call_apply_bind.html#_3-3-避免回调函数中的this" class="sidebar-link">3.3 避免回调函数中的this</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/002-this_call_apply_bind.html#_4-绑定this的方法" class="sidebar-link">4. 绑定this的方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/002-this_call_apply_bind.html#_4-1-function-prototype-call" class="sidebar-link">4.1 Function.prototype.call()</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/002-this_call_apply_bind.html#_4-2-function-prototype-apply" class="sidebar-link">4.2 Function.prototype.apply()</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/002-this_call_apply_bind.html#_4-3-function-prototype-bind" class="sidebar-link">4.3 Function.prototype.bind()</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/002-this_call_apply_bind.html#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/blog-demo/doc/js/003-数据类型转换.html" class="sidebar-link">数据类型转换</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/003-数据类型转换.html#_1-概述" class="sidebar-link">1. 概述</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/003-数据类型转换.html#_2-强制类型转换" class="sidebar-link">2. 强制类型转换</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/003-数据类型转换.html#_2-1-其他类型转数字的规则" class="sidebar-link">2.1 其他类型转数字的规则</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/003-数据类型转换.html#_2-2-其他类型转字符串规则" class="sidebar-link">2.2 其他类型转字符串规则</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/003-数据类型转换.html#_2-3-其他类型转布尔规则" class="sidebar-link">2.3 其他类型转布尔规则</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/003-数据类型转换.html#_2-4-强制转为数字方法：number-、parseint-、parsefloat-string" class="sidebar-link">2.4 强制转为数字方法：Number()、parseInt()、parseFloat(string)</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/003-数据类型转换.html#_2-5-强制转换为字符串方法：string-value" class="sidebar-link">2.5 强制转换为字符串方法：String(value)</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/003-数据类型转换.html#_2-6-强转为布尔方法：boolean" class="sidebar-link">2.6 强转为布尔方法：Boolean()</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/003-数据类型转换.html#_3-自动类型转换" class="sidebar-link">3. 自动类型转换</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/003-数据类型转换.html#_3-1-出现自动类型转换的情况" class="sidebar-link">3.1 出现自动类型转换的情况</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/003-数据类型转换.html#_3-2-非严格判断相等的转换规则" class="sidebar-link">3.2 ==非严格判断相等的转换规则</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/003-数据类型转换.html#_3-2-自动转换为布尔值" class="sidebar-link">3.2 自动转换为布尔值</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/003-数据类型转换.html#_3-3-自动转换为字符串" class="sidebar-link">3.3 自动转换为字符串</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/003-数据类型转换.html#_3-4-自动转换为数值" class="sidebar-link">3.4 自动转换为数值</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/003-数据类型转换.html#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/blog-demo/doc/js/004-跨域.html" class="active sidebar-link">跨域</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/004-跨域.html#浏览器阻止跨域的目的" class="sidebar-link">浏览器阻止跨域的目的</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/004-跨域.html#跨域介绍" class="sidebar-link">跨域介绍</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/004-跨域.html#同源策略-same-origin-policy" class="sidebar-link">同源策略(Same origin Policy)</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/004-跨域.html#一个跨域的例子" class="sidebar-link">一个跨域的例子</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/004-跨域.html#如何进行跨域访问？" class="sidebar-link">如何进行跨域访问？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/004-跨域.html#使用jsonp来实现跨域访问" class="sidebar-link">使用JSONP来实现跨域访问</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/004-跨域.html#cors-跨域资源共享（cross-origin-resource-sharing）" class="sidebar-link">CORS 跨域资源共享（Cross-Origin Resource Sharing）</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/004-跨域.html#iframe跨域方法" class="sidebar-link">iframe跨域方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/004-跨域.html#降域：document-domain" class="sidebar-link">降域：document.domain</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/004-跨域.html#window-postmessage页面通信" class="sidebar-link">window.postMessage页面通信</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/004-跨域.html#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/blog-demo/doc/js/005-Ajax.html" class="sidebar-link">Ajax</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/005-Ajax.html#使用xmlhttprequest实现ajax" class="sidebar-link">使用XMLHttpRequest实现Ajax</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/005-Ajax.html#使用xmlhttprequest-发一个请求" class="sidebar-link">使用XMLHTTPRequest()发一个请求</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/005-Ajax.html#参考" class="sidebar-link">参考</a></li></ul></li><li><a href="/blog-demo/doc/js/006-函数.html" class="sidebar-link">函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/006-函数.html#_1-函数介绍" class="sidebar-link">1. 函数介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/006-函数.html#_1-1-函数的三种声明" class="sidebar-link">1.1 函数的三种声明</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/006-函数.html#_1-2-函数的重复声明：后面覆盖前面" class="sidebar-link">1.2 函数的重复声明：后面覆盖前面</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/006-函数.html#_1-3-函数调用、return语句、调用自身、函数是一种值" class="sidebar-link">1.3 函数调用、return语句、调用自身、函数是一种值</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/006-函数.html#_1-4-函数名提升" class="sidebar-link">1.4 函数名提升</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/006-函数.html#_2-函数的属性和方法" class="sidebar-link">2. 函数的属性和方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/006-函数.html#_2-1-name属性" class="sidebar-link">2.1 name属性</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/006-函数.html#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/blog-demo/doc/js/007-作用域.html" class="sidebar-link">作用域</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/007-作用域.html#_1-什么是作用域？" class="sidebar-link">1. 什么是作用域？</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/007-作用域.html#_2-为什么需要作用域？最小访问原则" class="sidebar-link">2. 为什么需要作用域？最小访问原则</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/007-作用域.html#_3-javascript中的作用域" class="sidebar-link">3. JavaScript中的作用域</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/007-作用域.html#_3-1-全局作用域" class="sidebar-link">3.1 全局作用域</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/007-作用域.html#_3-2-局部作用域" class="sidebar-link">3.2 局部作用域</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/007-作用域.html#_3-3-块语句" class="sidebar-link">3.3 块语句</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/007-作用域.html#_3-4-作用域生存周期" class="sidebar-link">3.4 作用域生存周期</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/007-作用域.html#_4-上下文" class="sidebar-link">4. 上下文</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/007-作用域.html#_5-执行环境" class="sidebar-link">5. 执行环境</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/007-作用域.html#_6-创建阶段" class="sidebar-link">6 创建阶段</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/007-作用域.html#_6-1-变量对象" class="sidebar-link">6.1 变量对象</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/007-作用域.html#_6-2-作用域链" class="sidebar-link">6.2 作用域链</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/007-作用域.html#_6-3-执行环境对象" class="sidebar-link">6.3 执行环境对象</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/007-作用域.html#_7-代码执行阶段" class="sidebar-link">7. 代码执行阶段</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/007-作用域.html#_7-1-词法作用域" class="sidebar-link">7.1 词法作用域</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/007-作用域.html#_7-2-闭包" class="sidebar-link">7.2 闭包</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/007-作用域.html#_8-共有作用域和私有作用域" class="sidebar-link">8. 共有作用域和私有作用域</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/007-作用域.html#_8-1-模块模式" class="sidebar-link">8.1 模块模式</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/007-作用域.html#_8-2-立即执行函数表达式（iife）" class="sidebar-link">8.2 立即执行函数表达式（IIFE）</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/007-作用域.html#_9-使用-call-，-apply-和-bind-改变上下文" class="sidebar-link">9. 使用 .call()， .apply() 和 .bind() 改变上下文</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/007-作用域.html#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/blog-demo/doc/js/008-排序算法.html" class="sidebar-link">排序算法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/008-排序算法.html#_1-冒泡排序" class="sidebar-link">1. 冒泡排序</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/008-排序算法.html#_2-快读排序" class="sidebar-link">2. 快读排序</a></li></ul></li><li><a href="/blog-demo/doc/js/009-获取标签宽高及实例.html" class="sidebar-link">获取标签的宽高及例子</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/009-获取标签宽高及实例.html#_1-常用的获取宽高的属性" class="sidebar-link">1. 常用的获取宽高的属性</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/009-获取标签宽高及实例.html#_2-关于offset的5个属性" class="sidebar-link">2. 关于offset的5个属性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/009-获取标签宽高及实例.html#_2-1-offsetwidth与offsetheight" class="sidebar-link">2.1 offsetWidth与offsetHeight</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/009-获取标签宽高及实例.html#_2-3-offsetleft与offsettop" class="sidebar-link">2.3 offsetLeft与offsetTop</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/009-获取标签宽高及实例.html#_2-4-offsetparent" class="sidebar-link">2.4 offsetParent</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/009-获取标签宽高及实例.html#_3-关于宽高的实际应用" class="sidebar-link">3. 关于宽高的实际应用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/009-获取标签宽高及实例.html#_3-1-判断滚动条到底的条件" class="sidebar-link">3.1 判断滚动条到底的条件</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/009-获取标签宽高及实例.html#_3-2-js判断div内离开顶部，-设置滚动到指定位置，-判断滚动到达底部：" class="sidebar-link">3.2 JS判断div内离开顶部， 设置滚动到指定位置， 判断滚动到达底部：</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/009-获取标签宽高及实例.html#_3-3-获取浏览器窗口宽度" class="sidebar-link">3.3 获取浏览器窗口宽度</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/009-获取标签宽高及实例.html#_4-document-compatmode对获取浏览器窗口大小的影响" class="sidebar-link">4. document.compatMode对获取浏览器窗口大小的影响</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/009-获取标签宽高及实例.html#_4-1-backcompat：-浏览器高度使用body的值" class="sidebar-link">4.1 BackCompat： 浏览器高度使用body的值</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/009-获取标签宽高及实例.html#_4-2-css1compat：浏览器高度使用documentelement的值" class="sidebar-link">4.2 CSS1Compat：浏览器高度使用documentElement的值</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/009-获取标签宽高及实例.html#_4-3-doctype-会影响document-compatmode" class="sidebar-link">4.3 DOCTYPE 会影响document.compatMode</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/009-获取标签宽高及实例.html#_4-4-documentelement和body" class="sidebar-link">4.4 documentElement和body</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/009-获取标签宽高及实例.html#_5-浏览器兼容性问题" class="sidebar-link">5. 浏览器兼容性问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/009-获取标签宽高及实例.html#_5-1-各浏览器下-scrolltop的差异" class="sidebar-link">5.1 各浏览器下 scrollTop的差异</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/009-获取标签宽高及实例.html#_6-一些问题" class="sidebar-link">6. 一些问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/009-获取标签宽高及实例.html#_6-1-document-body-scrolltop总是0的原因" class="sidebar-link">6.1 document.body.scrollTop总是0的原因</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/009-获取标签宽高及实例.html#_6-2-给body标签设置高度后，显示的效果是一实际高度算的" class="sidebar-link">6.2 给body标签设置高度后，显示的效果是一实际高度算的</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/009-获取标签宽高及实例.html#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/blog-demo/doc/js/010-从输入URL到页面渲染过程.html" class="sidebar-link">从输入URL到页面渲染过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/010-从输入URL到页面渲染过程.html#_1-url解析" class="sidebar-link">1. URL解析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/010-从输入URL到页面渲染过程.html#_1-1-地址解析" class="sidebar-link">1.1 地址解析</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/010-从输入URL到页面渲染过程.html#_1-2-hsts" class="sidebar-link">1.2 HSTS</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/010-从输入URL到页面渲染过程.html#_1-3-其他操作" class="sidebar-link">1.3 其他操作</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/010-从输入URL到页面渲染过程.html#_1-4-缓存检查" class="sidebar-link">1.4 缓存检查</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/010-从输入URL到页面渲染过程.html#_2-dns查询" class="sidebar-link">2. DNS查询</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/010-从输入URL到页面渲染过程.html#_3-tcp链接" class="sidebar-link">3. TCP链接</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/010-从输入URL到页面渲染过程.html#_3-1-tcp-ip分层" class="sidebar-link">3.1 TCP/IP分层</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/010-从输入URL到页面渲染过程.html#_3-2-tcp三次握手建立连接" class="sidebar-link">3.2 TCP三次握手建立连接</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/010-从输入URL到页面渲染过程.html#_3-3-tcp四次挥手断开连接" class="sidebar-link">3.3 TCP四次挥手断开连接</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/010-从输入URL到页面渲染过程.html#_4-服务器处理请求" class="sidebar-link">4. 服务器处理请求</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/010-从输入URL到页面渲染过程.html#_5-浏览器接受响应" class="sidebar-link">5. 浏览器接受响应</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/010-从输入URL到页面渲染过程.html#_6-渲染页面" class="sidebar-link">6. 渲染页面</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/010-从输入URL到页面渲染过程.html#_6-1-浏览器内核、渲染流程" class="sidebar-link">6.1 浏览器内核、渲染流程</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/010-从输入URL到页面渲染过程.html#_6-2-html解析" class="sidebar-link">6.2 HTML解析</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/010-从输入URL到页面渲染过程.html#_6-3-css解析" class="sidebar-link">6.3 CSS解析</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/010-从输入URL到页面渲染过程.html#_6-4-生成渲染树" class="sidebar-link">6.4 生成渲染树</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/010-从输入URL到页面渲染过程.html#_6-5-布局、绘制、渲染" class="sidebar-link">6.5 布局、绘制、渲染</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/010-从输入URL到页面渲染过程.html#_6-6-回流与重绘" class="sidebar-link">6.6 回流与重绘</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/010-从输入URL到页面渲染过程.html#_7-javascript-编译执行" class="sidebar-link">7. JavaScript 编译执行</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/010-从输入URL到页面渲染过程.html#_7-1-词法分析" class="sidebar-link">7.1 词法分析</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/010-从输入URL到页面渲染过程.html#_7-2-预编译" class="sidebar-link">7.2 预编译</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/010-从输入URL到页面渲染过程.html#_7-3-执行" class="sidebar-link">7.3 执行</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/010-从输入URL到页面渲染过程.html#参考资料：" class="sidebar-link">参考资料：</a></li></ul></li><li><a href="/blog-demo/doc/js/013-JS浮点数运算的精度问题.html" class="sidebar-link">JavaScript浮点数运算的精度问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/013-JS浮点数运算的精度问题.html#_1-js中浮点数运算问题" class="sidebar-link">1. JS中浮点数运算问题</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/013-JS浮点数运算的精度问题.html#_2-问题原因" class="sidebar-link">2. 问题原因</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/013-JS浮点数运算的精度问题.html#_3-计算过程" class="sidebar-link">3. 计算过程</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/013-JS浮点数运算的精度问题.html#_4-整数的精度问题" class="sidebar-link">4. 整数的精度问题</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/013-JS浮点数运算的精度问题.html#_5-解决方案" class="sidebar-link">5. 解决方案</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/013-JS浮点数运算的精度问题.html#_5-1-第三方类库" class="sidebar-link">5.1 第三方类库</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/013-JS浮点数运算的精度问题.html#_5-2-整数表示" class="sidebar-link">5.2 整数表示</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/013-JS浮点数运算的精度问题.html#_6-格式化数字、金额、保留几位小数等" class="sidebar-link">6 格式化数字、金额、保留几位小数等</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/013-JS浮点数运算的精度问题.html#_7-浮点数运算解决方法" class="sidebar-link">7. 浮点数运算解决方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/013-JS浮点数运算的精度问题.html#_7-1-tofixed-方法" class="sidebar-link">7.1 toFixed() 方法</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/013-JS浮点数运算的精度问题.html#_7-2-加法函数" class="sidebar-link">7.2 加法函数</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/013-JS浮点数运算的精度问题.html#_7-3-减法函数" class="sidebar-link">7.3 减法函数</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/013-JS浮点数运算的精度问题.html#_7-4-乘法函数" class="sidebar-link">7.4 乘法函数</a></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/013-JS浮点数运算的精度问题.html#_7-5-除法函数" class="sidebar-link">7.5 除法函数</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog-demo/doc/js/013-JS浮点数运算的精度问题.html#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS代码执行机制和事件循环</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>高级</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>文章</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#浏览器阻止跨域的目的">浏览器阻止跨域的目的</a></li><li><a href="#跨域介绍">跨域介绍</a></li><li><a href="#同源策略-same-origin-policy">同源策略(Same origin Policy)</a></li><li><a href="#一个跨域的例子">一个跨域的例子</a></li><li><a href="#如何进行跨域访问？">如何进行跨域访问？</a><ul><li><a href="#使用jsonp来实现跨域访问">使用JSONP来实现跨域访问</a></li><li><a href="#cors-跨域资源共享（cross-origin-resource-sharing）">CORS 跨域资源共享（Cross-Origin Resource Sharing）</a></li></ul></li><li><a href="#iframe跨域方法">iframe跨域方法</a><ul><li><a href="#降域：document-domain">降域：document.domain</a></li><li><a href="#window-postmessage页面通信">window.postMessage页面通信</a></li></ul></li><li><a href="#参考资料">参考资料</a></li></ul></div><p></p> <p>[TOC]</p> <h1 id="跨域"><a href="#跨域" class="header-anchor">#</a> 跨域</h1> <h2 id="浏览器阻止跨域的目的"><a href="#浏览器阻止跨域的目的" class="header-anchor">#</a> 浏览器阻止跨域的目的</h2> <ul><li><p>安全问题</p> <p>如CSRF就是利用跨域攻击的。</p> <p>CSRF（Cross-site request forgery），中文名称：跨站请求伪造</p> <p>CSRF攻击：攻击者盗用了你的身份，以你的名义发送恶意请求。CSRF能够做的事情包括：以你名义发送邮件，发消息，盗取你的账号，甚至于购买商品，虚拟货币转账......造成的问题包括：个人隐私泄露以及财产安全。</p> <p>原理： 浏览器在发送请求的时候，会在请求中附加cookie信息，那么根据cookie信息，服务器就会任务是本人亲自操作，前提是用户登陆过这个网站。</p></li> <li><p>禁止那些不允许跨域调用其他页面的对象。</p></li></ul> <h2 id="跨域介绍"><a href="#跨域介绍" class="header-anchor">#</a> 跨域介绍</h2> <p>当一个资源从与该资源本身所在的服务器不同的域或端口请求一个资源时，资源会发起一个<strong>跨域 HTTP 请求</strong>。</p> <p>出于安全原因，<strong>浏览器限制从脚本内发起的跨源HTTP请求。</strong> 例如，XMLHttpRequest和Fetch API遵循同源策略。 这意味着使用这些API的Web应用程序只能从加载应用程序的同一个域请求HTTP资源，除非使用CORS头文件。</p> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS" target="_blank" rel="noopener noreferrer">HTTP访问控制 MDN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>当访问API发生跨域的时候，浏览器会报如下错误：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code>Failed to load http://api.douban.com/v2/movie/top250: No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin 'http://127.0.0.1:8080' is therefore not allowed access.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>跨域发生时： 数据已经返回了(API正常返回了结果)，但是浏览器检查发现不是同源的，那么阻止了。</p> <h2 id="同源策略-same-origin-policy"><a href="#同源策略-same-origin-policy" class="header-anchor">#</a> 同源策略(Same origin Policy)</h2> <p>同源策略是浏览器自己的行为，如果访问接口不是在浏览器上发生则不会有这个问题产生。</p> <p>浏览器出于安全方面的考虑，只允许与本域下的接口交互。不同源的客户端脚本在没有明确授权的情况下，不能读写对方的资源。</p> <p>如果两个页面的协议，端口（如果有指定）和域名都相同，则两个页面具有相同的<strong>源</strong>。</p> <ul><li>同协议：如都是http或者https</li> <li>同域名：如都是<code>http://www.abc.com/a.html</code> 和<code>http://www.abc.com/b.html</code></li> <li>同端口：如都是80端口</li></ul> <p>相对<code>http://store.company.com/dir/page.html</code>同源检测的示例:</p> <table><thead><tr><th>URL</th> <th>结果</th> <th>原因</th></tr></thead> <tbody><tr><td><code>http://store.company.com/dir2/other.html</code></td> <td>成功</td> <td></td></tr> <tr><td><code>http://store.company.com/dir/inner/another.html</code></td> <td>成功</td> <td></td></tr> <tr><td><code>https://store.company.com/secure.html</code></td> <td>失败</td> <td>不同协议 ( https和http )</td></tr> <tr><td><code>http://store.company.com:81/dir/etc.html</code></td> <td>失败</td> <td>不同端口 ( 81和80)</td></tr> <tr><td><code>http://news.company.com/dir/other.html</code></td> <td>失败</td> <td>不同域名 ( news和store )</td></tr></tbody></table> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy" target="_blank" rel="noopener noreferrer">浏览器的同源策略 MDN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="一个跨域的例子"><a href="#一个跨域的例子" class="header-anchor">#</a> 一个跨域的例子</h2> <blockquote><p>服务器端</p></blockquote> <ol><li><p>安装node.js</p> <p>如果没有没有安装nodejs,那么去官网下载：<a href="https://nodejs.org/en/download/" target="_blank" rel="noopener noreferrer">https://nodejs.org/en/download/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p>创建一个目录，在这个目录中创建一个server.js文件，内容如下：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span>

http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

  <span class="token keyword">var</span> pathObj <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>

  <span class="token keyword">switch</span> <span class="token punctuation">(</span>pathObj<span class="token punctuation">.</span>pathname<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'/getWeather'</span><span class="token operator">:</span>
      res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>beijing<span class="token operator">:</span> <span class="token string">'sunny'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">default</span><span class="token operator">:</span>
      fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> pathObj<span class="token punctuation">.</span>pathname<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
          res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token string">'not found'</span><span class="token punctuation">)</span>
          res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'&lt;h1&gt;404 Not Found&lt;/h1&gt;'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
          res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span> 
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div></li> <li><p>终端打开这个项目目录，运行<code>node server.js</code>启动服务，服务地址：<code>http://localhost:8080/</code></p></li></ol> <blockquote><p>页面端服务</p></blockquote> <ol><li><p>安装http-server服务</p> <p>如果没有安装，终端运行：<code>npm install http-server -g</code>， npm命令是安装nodeJS带的。</p> <p>http-server介绍：https://github.com/indexzero/http-server</p></li> <li><p>在上面的目录中新建一个index.html文件，代码如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;h1&gt;饥人谷&lt;/h1&gt;
&lt;script&gt;
  var xhr = new XMLHttpRequest()
  xhr.open('GET','http://localhost:8080/getWeather', true)
  xhr.send()
  xhr.onload = function(){
    console.log(xhr.responseText)
  }
&lt;/script&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>使用http-server命令启动web服务</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>http-server
Starting up http-server, serving ./
Available on:
  http://127.0.0.1:8081
  http://192.168.43.183:8081
Hit CTRL-C to stop the server
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ol> <blockquote><p>访问页面则提示产生跨域问题</p></blockquote> <p>当在浏览器中打开：<code>http://127.0.0.1:8081</code>页面是，浏览器就是提示如下错误：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Failed to load http://localhost:8080/getWeather: No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin 'http://127.0.0.1:8081' is therefore not allowed access.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="如何进行跨域访问？"><a href="#如何进行跨域访问？" class="header-anchor">#</a> 如何进行跨域访问？</h2> <h3 id="使用jsonp来实现跨域访问"><a href="#使用jsonp来实现跨域访问" class="header-anchor">#</a> 使用JSONP来实现跨域访问</h3> <h4 id="jsonp的原理"><a href="#jsonp的原理" class="header-anchor">#</a> JSONP的原理</h4> <p><code>JSONP</code>是<code>JSON with Padding</code>的简称，一般用来解决<code>Ajax</code>跨域的问题。它是这样产生的：</p> <ol><li>页面上调用<code>js</code>文件时不受跨域的影响，而且，凡是拥有src属性的标签都拥有跨域的能力，比如<code>&lt;script&gt;</code>、<code>&lt;img&gt;</code>、<code>&lt;iframe&gt;</code>。</li> <li>可以在远程服务器上把数据装进<code>js</code>格式的文件里，供客户端调用处理，实现跨域。</li> <li>目前最常用的数据交换方式是<code>JSON</code>，客户端通过调用远程服务器上动态生成的<code>js</code>格式文件（一般以<code>JSON</code>后缀）。</li> <li>客户端成功调用<code>JSON</code>文件后，对其进行处理。</li> <li>为了便于客户端使用数据，逐渐形成了一种非正式传输协议，人们把它称作<code>JSONP</code>，该协议的一个要点就是允许用户传递一个<code>callback</code>参数给服务端，然后服务端返回数据时会将这个<code>callback</code>参数作为函数名来包裹住<code>JSON</code>数据，这样客户端就可以随意定制自己的函数来自动处理返回数据了。</li></ol> <p><a href="https://segmentfault.com/a/1190000007232373" target="_blank" rel="noopener noreferrer">浅谈 JSONP 的原理与实现<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h4 id="jsonp的实现"><a href="#jsonp的实现" class="header-anchor">#</a> JSONP的实现</h4> <ol><li>在页面中声明一个函数，然后写一个script 标签，标签里面的src链接为API接口，通过接口传参的方式把函数名写上。</li> <li>后台API在解析到函数名后，会把返回的数据拼接成函数参数<code>function(data)</code>,然后返回给页面。</li> <li>页面在加载完脚本后，会当JS文件去执行，那么就相当于调用函数，此时页面声明的函数就可以处理API返回的数据了。</li> <li>需要前端、后端共同配合。</li></ol> <p>一个例子：</p> <p>server.js</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>
<span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span>

http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> pathObj <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>

  <span class="token keyword">switch</span> <span class="token punctuation">(</span>pathObj<span class="token punctuation">.</span>pathname<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'/getNews'</span><span class="token operator">:</span>
      <span class="token keyword">var</span> news <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;第11日前瞻：中国冲击4金 博尔特再战200米羽球&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;正直播柴飚/洪炜出战 男双力争会师决赛&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;女排将死磕巴西！郎平安排男陪练模仿对方核心&quot;</span>
        <span class="token punctuation">]</span>
      res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span><span class="token string">'text/json; charset=utf-8'</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>pathObj<span class="token punctuation">.</span>query<span class="token punctuation">.</span>callback<span class="token punctuation">)</span><span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>pathObj<span class="token punctuation">.</span>query<span class="token punctuation">.</span>callback <span class="token operator">+</span> <span class="token string">'('</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>news<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">')'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>news<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">default</span><span class="token operator">:</span>
      fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> pathObj<span class="token punctuation">.</span>pathname<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
          res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token string">'not found'</span><span class="token punctuation">)</span>
          res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'&lt;h1&gt;404 Not Found&lt;/h1&gt;'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
          res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span> 
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>index.html</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>news<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>show<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>show news<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">function</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.show'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'http://127.0.0.1:8080/getNews?callback=appendHtml'</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">function</span> <span class="token function">appendHtml</span><span class="token punctuation">(</span><span class="token parameter">news</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>news<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      html <span class="token operator">+=</span> <span class="token string">'&lt;li&gt;'</span> <span class="token operator">+</span> news<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'&lt;/li&gt;'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.news'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> html<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="cors-跨域资源共享（cross-origin-resource-sharing）"><a href="#cors-跨域资源共享（cross-origin-resource-sharing）" class="header-anchor">#</a> CORS 跨域资源共享（Cross-Origin Resource Sharing）</h3> <p>CORS是一个W3C标准,它允许浏览器向跨源服务器，发出<a href="http://www.ruanyifeng.com/blog/2012/09/xmlhttprequest_level_2.html" target="_blank" rel="noopener noreferrer"><code>XMLHttpRequest</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>请求，从而克服了AJAX只能<a href="http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html" target="_blank" rel="noopener noreferrer">同源<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>使用的限制。</p> <p>CORS需要浏览器和服务器同时支持。目前，所有浏览器都支持该功能，IE浏览器不能低于IE10。</p> <p>整个CORS通信过程，都是浏览器自动完成，不需要用户参与。浏览器一旦发现AJAX请求跨源，就会自动添加一些附加的头信息，有时还会多出一次附加的请求，但用户不会有感觉。</p> <p>因此，实现CORS通信的关键是服务器。只要服务器实现了CORS接口，就可以跨源通信。</p> <h4 id="cors步骤"><a href="#cors步骤" class="header-anchor">#</a> CORS步骤</h4> <ol><li><p>浏览器发现跨域，在请求中添加<code>Origin</code>字段</p> <p>当使用XMLHttpRequest发送请求时，浏览器发现有跨域，会自动在请求头中添加一个<code>Origin</code>字段：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// Request Headers
Host: localhost:8081
Origin: http://127.0.0.1:8081
Pragma: no-cache
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>Origin</code>用来说明请求来自哪个源（协议 + 域名 + 端口）。服务器根据这个值，决定是否同意这次请求。</p></li> <li><p>服务器设置允许跨域的地址：<code>Access-Control-Allow-Origin</code></p> <p>如果请求中Origin指定的地址 <strong>禁止跨域</strong>，服务器会返回一个正常的HTTP相应。</p> <p>如果请求中Origin指定的地址 <strong>允许跨域</strong>，服务器会在响应头中添加几点字段：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Access-Control-Allow-Origin: http://localhost:8081
Access-Control-Allow-Credentials: true
Access-Control-Expose-Headers: FooBar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>Access-Control-Allow-Origin</strong>: 必须字段，它的值要么是请求时<code>Origin</code>字段的值，要么是一个<code>*</code>，表示接受任意域名的请求。</p> <p><strong>Access-Control-Allow-Credentials</strong>：可选字段，它的值是一个布尔值，表示是否允许发送Cookie。</p> <p><strong>Access-Control-Expose-Headers</strong>：可选字段，设置<code>XMLHttpRequest</code>对象的<code>getResponseHeader()</code>方法只能拿到其他字段。</p></li></ol> <h4 id="一个cors例子"><a href="#一个cors例子" class="header-anchor">#</a> 一个CORS例子</h4> <p>server.js</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span>

http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> pathObj <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>

  <span class="token keyword">switch</span> <span class="token punctuation">(</span>pathObj<span class="token punctuation">.</span>pathname<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'/getNews'</span><span class="token operator">:</span>
      <span class="token keyword">var</span> news <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>
      res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Origin'</span><span class="token punctuation">,</span><span class="token string">'http://localhost:8080'</span><span class="token punctuation">)</span>
      <span class="token comment">//res.setHeader('Access-Control-Allow-Origin','*')</span>
      res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>news<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> pathObj<span class="token punctuation">.</span>pathname<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
          res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token string">'not found'</span><span class="token punctuation">)</span>
          res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'&lt;h1&gt;404 Not Found&lt;/h1&gt;'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
          res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span> 
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>index.html</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>news<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>show<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>show news<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.show'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'http://127.0.0.1:8080/getNews'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token function">appendHtml</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">function</span> <span class="token function">appendHtml</span><span class="token punctuation">(</span><span class="token parameter">news</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>news<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      html <span class="token operator">+=</span> <span class="token string">'&lt;li&gt;'</span> <span class="token operator">+</span> news<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'&lt;/li&gt;'</span>
    <span class="token punctuation">}</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.news'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> html
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token parameter">selector</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p><strong>注：</strong><code>http://localhost:8080</code> 和<code>http://127.0.0.1:8080</code>不同源。</p> <p><a href="http://www.ruanyifeng.com/blog/2016/04/cors.html" target="_blank" rel="noopener noreferrer">跨域资源共享 CORS 详解 阮一峰<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="iframe跨域方法"><a href="#iframe跨域方法" class="header-anchor">#</a> iframe跨域方法</h2> <p>当页面使用iframe标签内嵌其他页面的时候，那么浏览器会禁止JS操作内嵌页面元素，只有同源的页面才允许操作。</p> <p>如果想要不同源的页面可以操作那么可使用如下方法：</p> <h3 id="降域：document-domain"><a href="#降域：document-domain" class="header-anchor">#</a> 降域：document.domain</h3> <p>如果两个窗口一级域名相同，只是二级域名不同， document.domain方法：获取/设置当前文档的原始域部分:</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//初始值 &quot;home.example.com&quot; </span>
document<span class="token punctuation">.</span>domain <span class="token operator">=</span> <span class="token string">&quot;example.com&quot;</span><span class="token punctuation">;</span> 		<span class="token comment">//OK</span>
document<span class="token punctuation">.</span>domain <span class="token operator">=</span> <span class="token string">&quot;home.example.com&quot;</span><span class="token punctuation">;</span> 	<span class="token comment">//NO,不能由松散变紧绷</span>
document<span class="token punctuation">.</span>domain <span class="token operator">=</span> <span class="token string">&quot;example&quot;</span><span class="token punctuation">;</span> 			<span class="token comment">//NO，必须有一个点号</span>
document<span class="token punctuation">.</span>domain <span class="token operator">=</span> <span class="token string">&quot;another.com&quot;</span><span class="token punctuation">;</span> 		<span class="token comment">//NO， 必须是有效域前缀或其本身</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>一个例子</p></blockquote> <ol><li>修改hosts文件，模拟2个域名</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>## sudo vi /etc/hosts 
// 在文件里添加如下2行内容
127.0.0.1 a.etc.com
127.0.0.1 b.etc.com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li><p>创建2个文件，然后启动http-server</p> <p>a.html</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
  <span class="token selector">.ct</span><span class="token punctuation">{</span> <span class="token property">width</span><span class="token punctuation">:</span> 910px<span class="token punctuation">;</span> <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token selector">.main</span><span class="token punctuation">{</span> <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span> <span class="token property">width</span><span class="token punctuation">:</span> 450px<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span> <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #ccc<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.main input</span><span class="token punctuation">{</span> <span class="token property">margin</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span> <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token selector">.iframe</span><span class="token punctuation">{</span> <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token selector">iframe</span><span class="token punctuation">{</span> <span class="token property">width</span><span class="token punctuation">:</span> 450px<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span> <span class="token property">border</span><span class="token punctuation">:</span> 1px dashed #ccc<span class="token punctuation">;</span> <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ct<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>使用降域实现跨域<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>main<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>a.html<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://b.etc.com:8080/b.html<span class="token punctuation">&quot;</span></span> <span class="token attr-name">frameborder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.main input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  window<span class="token punctuation">.</span>frames<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
document<span class="token punctuation">.</span>domain <span class="token operator">=</span> <span class="token string">&quot;etc.com&quot;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>b.html</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;html&gt;
&lt;head&gt;
  &lt;meta charset=&quot;utf-8&quot;&gt;
&lt;style&gt;
	html,body{ margin: 0; }
	input{ margin: 20px; width: 200px; }
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;input id=&quot;input&quot; type=&quot;text&quot;  placeholder=&quot;b.html&quot;&gt;
&lt;script&gt;
document.querySelector('#input').addEventListener('input', function(){
	window.parent.document.querySelector('input').value = this.value;
})
document.domain = 'etc.com';
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li> <li><p>终端打开该文件目录，启动服务：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>~ http-server

Starting up http-server, serving ./
Available on:
  http://127.0.0.1:8080
  http://192.168.43.183:8080
Hit CTRL-C to stop the server
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>浏览器中打开链接：<code>http://a.etc.com:8080/a.html</code>就能看见效果。</p> <p>如果不在两个页面中设置<code>document.domain = 'etc.com';</code>, 那么久没有效果。</p></li></ol> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/domain" target="_blank" rel="noopener noreferrer">Document.domain MDN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="window-postmessage页面通信"><a href="#window-postmessage页面通信" class="header-anchor">#</a> window.postMessage页面通信</h3> <p><code>postMessge()</code>是HTML5新定义的通信机制。所有主流浏览器都已实现。</p> <p>postMessage()方法允许跨窗口通信，不论这两个窗口是否同源。</p> <ul><li>发送消息</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>otherWindow.postMessage(message, targetOrigin);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>otherWindow</strong>:其他窗口的一个引用，比如iframe的contentWindow属性、执行<a href="https://developer.mozilla.org/en-US/docs/DOM/window.open" target="_blank" rel="noopener noreferrer">window.open<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>返回的窗口对象、或者是命名过或数值索引的<a href="https://developer.mozilla.org/en-US/docs/DOM/window.frames" target="_blank" rel="noopener noreferrer">window.frames<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p><strong>message</strong>: 将要发送到其他 window的数据。</p> <p><strong>targetOrigin</strong>:接收消息的窗口的源（origin），即&quot;协议 + 域名 + 端口&quot;。也可以设为<code>*</code>，表示不限制域名，向所有窗口发送。</p> <ul><li>监听处理消息</li></ul> <p>父窗口和子窗口都可以通过<code>message</code>事件，监听对方的消息。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>window.addEventListener('message', function(e) {
  console.log(e.data);
});
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>message</code>事件的事件对象<code>event</code>，提供以下三个属性。</p> <ul><li><code>event.source</code>：发送消息的窗口</li> <li><code>event.origin</code>: 消息发向的网址</li> <li><code>event.data</code>: 消息内容</li></ul> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/postMessage" target="_blank" rel="noopener noreferrer">window.postMessage mdn<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <blockquote><p>例子</p></blockquote> <p>上面的代码修改一下：</p> <p>a.html</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">function</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.main input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span>frames<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.main input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">=</span> e<span class="token punctuation">.</span>data
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>b.html</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
	<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		window<span class="token punctuation">.</span>parent<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">=</span> e<span class="token punctuation">.</span>data
	    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">function</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <p><a href="http://book.jirengu.com/fe/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80/Javascript/%E8%B7%A8%E5%9F%9F.html" target="_blank" rel="noopener noreferrer">饥人谷跨域课件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="http://www.ruanyifeng.com/blog/2016/04/cors.html" target="_blank" rel="noopener noreferrer">跨域资源共享 CORS 详解 阮一峰<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html" target="_blank" rel="noopener noreferrer">浏览器同源政策及其规避方法 阮一峰<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://segmentfault.com/a/1190000006908944" target="_blank" rel="noopener noreferrer">关于跨域 SegmentFault<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog-demo/doc/js/003-数据类型转换.html" class="prev">
        数据类型转换
      </a></span> <span class="next"><a href="/blog-demo/doc/js/005-Ajax.html">
        Ajax
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog-demo/assets/js/app.d550568f.js" defer></script><script src="/blog-demo/assets/js/2.9eb2f958.js" defer></script><script src="/blog-demo/assets/js/18.ff8b777b.js" defer></script>
  </body>
</html>
